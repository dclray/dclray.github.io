(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{573:function(s,e,t){"use strict";t.r(e);var a=t(6),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"websocket-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#websocket-协议"}},[s._v("#")]),s._v(" websocket 协议")]),s._v(" "),t("p",[s._v("websocket是web浏览器和服务器之间的一种全双工通信协议，其中webSocket协议由IETF定位标准，webSocket API由W3C定位标准。一旦web客户端和服务器建立起连接，之后的全部数据通信都通过这个连接进行。通信过程中，可相互发送JSON、XML、HTML或图片等任意格式的数据。\nwebsocket 和HTTP协议的共同点：")]),s._v(" "),t("ul",[t("li",[s._v("都是基于TCP的应用层协议")]),s._v(" "),t("li",[s._v("都使用Request/Response模型进行连接的建立")]),s._v(" "),t("li",[s._v("在连接的建立过程中对错误的处理方式相同，在这个阶段WS可能返回和HTTP相同的返回码")]),s._v(" "),t("li",[s._v("都可以传输数据")])]),s._v(" "),t("p",[s._v("不同点在于：")]),s._v(" "),t("ul",[t("li",[s._v("WS使用HTTP来建立连接，但是定义了一系列新的header")]),s._v(" "),t("li",[s._v("WS的连接不能通过中间人来转发，它必须是一个直接连接")]),s._v(" "),t("li",[s._v("WS连接建立后，通信双方都可以在任何时刻向另一方发送数据")]),s._v(" "),t("li",[s._v("WS连接建立后，数据的传输使用帧来传递，不在需要request消息")]),s._v(" "),t("li",[s._v("WS的数据帧有序。")])]),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[s._v(" ❤  websocket是基于TCP的一个应用协议，与HTTP协议的关联之处在于websocket的握手数据被HTTP服务器当作HTTP包来处理，主要通过Update request HTTP包建立起连接，之后的通信全部使用websocket自己的协议。")])],1),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("GET /uin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxxxxxx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxxxxxxx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("token")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("XXXXXXXXXXXX HTTP/1.1\nHost: server.example.cn:443\nConnection: Upgrade\nPragma: no-cache\nCache-Control: no-cache\nUser-Agent: Mozilla/5.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Macintosh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Intel Mac OS X 10_15_2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AppleWebKit/537.36 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("KHTML, like Gecko"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Chrome/81.0.4044.138 Safari/537.36\nUpgrade: websocket\nSec-WebSocket-Version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("\nCookie: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("XXXXX\nSec-WebSocket-Key: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/2hTi/+eNURiekpNI4k5Q"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nSec-WebSocket-Extensions: permessage-deflate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" client_max_window_bits\nSec-WebSocket-Protocol: binary, base64\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"nginx-支持websocket-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-支持websocket-配置"}},[s._v("#")]),s._v(" nginx 支持websocket 配置")]),s._v(" "),t("p",[s._v("由于http 请求 涉及 反向代理 所以就涉及 nginx 配置需要支持 websocket 需要做一些特殊的配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置Nginx支持webSocket开始")]),s._v("\nproxy_set_header Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_http_version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_set_header Upgrade "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_set_header Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/LL845876425/article/details/106393358",target:"_blank",rel:"noopener noreferrer"}},[s._v("websocket协议详解及报文分析"),t("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=n.exports}}]);