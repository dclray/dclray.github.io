---
title: 浏览器架构
date: 2021-08-12
sidebar: auto
---
## CPU和GPU
CPU和GPU作为计算机中最重要的两个计算单元直接决定了计算性能。</br>
**CPU：**（Central Processing Unit）是计算机的大脑，负责处理各种不同的任务。在过去，大多数CPU是单芯片的，核心被安置在同一个芯片上。更新的CPU可以支持多核心，运算能力大大加强。而最新的CPU已经达到10核心20线程数的能力</br>
**GPU：**（Graphics Processing Unit）是计算机的另一个组成部分，和CPU不同，GPU更擅长利用多核心同时处理单一的任务。像命名那样，GPU最初被用于处理图像。这就是为什么使用GPU可以更快、更流畅的渲染页面内容。随着GPU的发展，越来越多的计算任务也可以使用GPU来处理。甚至有人说GPU是人工智能的大功臣，可见GPU已经不再仅用于图像处理上了。</br>
## 计算机架构
我们可以将计算机自下而上分成三层：硬件、操作系统和应用。有了操作系统的存在，上层的应用可以使用操作系统提供的能力使用硬件资源而不会直接访问硬件资源。</br>
## 进程和线程
一个进程是应用正在运行的程序，而线程是进程中更小的一部分。当应用被启动，进程就被创建出来。程序可以创建线程来帮助其工作。操作系统会为进程分配私有的内存空间以供使用，当关闭程序时，这段私有的内存也会被释放。其实还有比线程更小的存在就是协程，而协程是运行在线程中更小的单位。**async/await就是基于协程实现的**
## 进程间通信（IPC）
一个进程可以让操作系统开启另一个进程处理不同的任务。而当两个进程需要通信时，可以使用IPC（Inter Process Communication）。</br>
多说程序被设计成使用IPC来进行进程间的通信，好处在于当一个进程给另一个进程发消息而没有回应时，并不影响当前进程继续工作。
## 浏览器架构
借助进程和线程，浏览器可以被设计为单进程、多线程架构，或者利用IPC实现多进程、多线程架构。</br>
以Chrome多进程架构介绍，在Chrome中存在不同类型的进程，它们各司其职。</br>
<font color='red'> 浏览器进程作为Chrome中最核心的进程管理着Chrome中的其他进程，而Renderer则负责渲染不同的站点。</font> 

## 进程工作内容
浏览器四大进程：**浏览器进程**、**渲染进程**、**插件进程**、**GPU进程**</br>
**浏览器继承（Browser process）：** 浏览器进程负责管理Chrome应用本身，包括地址栏、书签、前进和后退按钮。同时也负责不可见的功能，比如网络请求，文件访问等，也负责其他进程的调度。</br>
**渲染进程（Renderer process）：** 渲染进程负责站点的渲染，其中包括JavaScript代码的运行，web worker的管理等</br>
**插件进程（Plugin process）：** 插件进程负责为浏览器提供各种额外的插件功能，例如flash</br>
**GPU进程（GPU process）：** GPU进程负责提供成像的功能。</br>
当然还有其他像扩展进程或工具进程等其他进程，可以在Chrome的Task Manager面板中查看，面板中列出了运行的进程和其占用的CPU、内存情况。

## 多进程架构的好处
当我们访问一个站点时，渲染进程会负责运行站点的代码，渲染站点的页面，同时响应用户的交互动作，当我们在Chrome中打开三个页签同时访问三个站点时，如果其中一个没有响应，我们可以关闭它然后使用其他的页签，这是因为Chrome为每个站点创建一个独立的渲染进程，专门处理当前站点的渲染工作。如果，所有的页面运行时在同一个进程中，当有一个页面没有响应时，所有的页面就都卡住了。</br>
另一个好处是，借助操作系统对进程安全的控制，浏览器可以将页面放置在沙箱中，站点的代码可以运行在隔离的环境中，保证核心进程的安全。</br>
虽然多进程的架构优于单进程架构，但由于进程独享自己的私有内存，以渲染进程为例，虽然渲染的站点不同，但工作内容大体相似，为了完成渲染工作它们会在自己的内存中包含相同的功能，例如V8引擎（用于解析和运行javaScript），这意味着这部分相同的功能需要占用每个进程的内存空间。为了节省内存，Chrome限制了最大进程数，最大进程数取决于硬件的能力，同时**当使用多个页签访问相同的站点时浏览器不会创建新的渲染进程**</br>



## 参考链接

- [Chrome 浏览器架构](https://xie.infoq.cn/article/5d36d123bfd1c56688e125ad3) 